# 高并发设计

参考资料：
涛哥：
https://yq0pkza686.feishu.cn/minutes/obcn6782l7t1np9y516f1ai2

## H5 接口请求性能瓶颈

### 在数据库

加缓存 Redis。

### 在 Redis

使用 local cache（机器），在这基础上可以加 nginx/cdn（静态资源）。

### 在机器上

CPU、内存。

## 延迟方案

### 消息队列

## 海量数据存储

### 分库分表

### 大数据存储

hive

### 缓存

zset：排行榜
set 数据结构：交集（共同好友列表）、差集（可能认识的朋友）

### 冷热数据方案

热数据：用户的前 100 条点赞视频
冷数据：用户的 非前 100 条点赞视频

## 面试高并发怎么回答？

明确场景；
确定具体业务、具体接口；
确定是 Qps 还是 Tps；
Qps：简单的查询，用多级缓存方案；
缓存一致性问题；
延迟方案（mq）、补偿机制（定时任务）；

## 接口耗时太长？

加缓存；
并发调用。
异步；

首先定位接口慢的原因：
查看日志，是否有异常、错误、接口每步的执行时间等；
通过性能监控分析工具，查看性能指标CPU、内存等；
Arthas
优化：
数据库性能问题：使用 Redis、ES 缓存数据，参考：MySQL调优。
程序、代码问题：
使用多线程并发处理相关任务；
使用 MQ 进行业务低耦合、异步处理的方式。
网络延迟：
使用 CDN 加速静态资源的加载；
服务尽量部署在同城或者同单元。
服务架构和硬件性能瓶颈：
服务拆分，减少服务之间的耦合度；
升级硬件。

