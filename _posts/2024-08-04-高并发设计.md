# 高并发设计

参考资料：
涛哥：
https://yq0pkza686.feishu.cn/minutes/obcn6782l7t1np9y516f1ai2

## H5 接口请求性能瓶颈

### 在数据库

加缓存 Redis。

### 在 Redis

使用 local cache（机器），在这基础上可以加 Nginx/CDN（静态资源）。

### 在机器上

CPU、内存。

## 延迟方案

### 消息队列

## 海量数据存储

### 分库分表

### 大数据存储

hive

### 缓存

zset：排行榜
set 数据结构：交集（共同好友列表）、差集（可能认识的朋友）

### 冷热数据方案

热数据：用户的前 100 条点赞视频
冷数据：用户的 非前 100 条点赞视频

## 面试高并发怎么回答？

明确场景；
确定具体业务、具体接口；
确定是 Qps 还是 Tps；
Qps：简单的查询，用多级缓存方案；
缓存一致性问题；
延迟方案（mq）、补偿机制（定时任务）；

## 接口耗时太长？

高并发设计三要素：
加缓存；
并发调用。
异步方案；
如何优化：
数据库出现性能瓶颈：
MySQL调优；
使用 Local Cache、Redis、ES 等技术缓存数据。
使用 Nginx 存放静态资源。
业务上：
使用多线程并发处理相关任务；
使用线程池、MQ、Okhttp等技术进行异步处理；
把数据进行批量操作；
预加载需要的资源。
代码上：
降低锁的粒度；
减少递归；
避免长事务；
...（等等）
服务架构：
采用分布式架构，拆分服务模块，减少系统内的耦合度，提高性能，同时也避免了单机部署的单点故障，即使其中一个服务单点故障也不会影响整个系统的运行，高可用；
集群部署，提升系统吞吐量和响应速度，并采用负载均衡技术给服务分配请求，提高服务性能和可用性。
硬件出现性能瓶颈：
升级硬件。
网络延迟：
使用 CDN 加速静态资源的加载；
服务尽量部署在同城或者同单元。
注：定位接口慢的方式：
查看日志，是否有异常、错误、接口每步的执行时间等；
通过性能监控分析工具，查看性能指标CPU、内存等。
Arthas
参考资料：
Holis：
https://www.yuque.com/hollis666/hgtuok/gfgqpua8gu3oag44

