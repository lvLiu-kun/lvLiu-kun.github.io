# 场景题

## 重复充值问题

充值成功后回调是有前后顺序的，如果收到了一个支付成功的回调，当收到第二个支付成功的回调时，发现已经支付成功了，记录下异常订单，然后执行退款流程（反向补偿）。

## 有一种数据是用 mq 的形式推过来的，这种数据是频繁发送且频繁变化的，比如用户的位置信息，如果用户的位置超出限制区域，需要对它处理，我们要怎么实现这块业务逻辑的处理？

对消息做幂等：
通过唯一消息 id 做幂等（时间戳）；
根据短时间内位置大幅度变化或者位置不变进行业务逻辑的幂等（一锁二判）。
可能会出现问题：
重复消息
消息积压

## 后台有一个要导入一个 6 万条的 Excel 文件数据的需求，导入后按每批次 100 条数据去调下游的接口，然后去处理结果，只需要去识别哪些是失败的数据，然后落库就行。如果你来设计的话，怎么处理？

面试官回答：用脚本做异步？Java 也可以去创建异步的并发请求的？

思路：按批次、异步（消息队列、线程池并发处理）、批量落库。

补充：不能把下游调挂了，所以要控制好并发数。

