# 场景题

## 重复充值问题

充值成功后回调是有前后顺序的，如果收到了一个支付成功的回调，当收到第二个支付成功的回调时，发现已经支付成功了，记录下异常订单，然后执行退款流程（反向补偿）。

## 有一种数据是用 mq 的形式推过来的，这种数据是频繁发送且频繁变化的，比如用户的位置信息，如果用户的位置超出限制区域，需要对它处理，我们要怎么实现这块业务逻辑的处理？

对消息做幂等：
通过唯一消息 id 做幂等（时间戳）；
根据短时间内位置大幅度变化或者位置不变进行业务逻辑的幂等（一锁二判）。
可能会出现问题：
重复消息
消息积压

